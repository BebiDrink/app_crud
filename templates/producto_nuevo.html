<!DOCTYPE html>
<html>
<head>
    <title>Productos</title>
    <!-- Agrega el enlace al archivo CSS de Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
</head>
<body>

    <div id="app" class="container">
        <h1>Productos</h1>

        <div id="alert-container"></div>

        <div v-if="currentPage === 'list'">
            <!-- Botón para agregar un nuevo producto -->
            <button class="btn btn-primary" @click="goToPage('add')">Agregar Producto</button>

            <!-- Tabla para mostrar los productos -->
            <h2>Lista de Productos</h2>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Precio</th>
                        <th>Stock</th>
                        <th>Imagen</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="producto in productos" :key="producto.id">
                        <td>{{ producto.id }}</td>
                        <td>{{ producto.nombre }}</td>
                        <td>{{ producto.precio }}</td>
                        <td>{{ producto.stock }}</td>
                        <td>{{ producto.imagen }}</td>
                        <td>
                            <button class="btn btn-primary" @click="editProducto(producto.id)">Editar</button>
                            <button class="btn btn-danger" @click="deleteProducto(producto.id)">Eliminar</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div v-if="currentPage === 'add'">
            <!-- Formulario para agregar un nuevo producto -->
            <h2>Agregar Producto</h2>
            <form @submit.prevent="createProducto">
                <div class="form-group">
                    <label for="nombre">Nombre</label>
                    <input type="text" class="form-control" v-model="nuevoProducto.nombre" required>
                </div>
                <div class="form-group">
                    <label for="precio">Precio</label>
                    <input type="number" class="form-control" v-model="nuevoProducto.precio" required>
                </div>
                <div class="form-group">
                    <label for="stock">Stock</label>
                    <input type="number" class="form-control" v-model="nuevoProducto.stock" required>
                </div>
                <div class="form-group">
                    <label for="imagen">Imagen</label>
                    <input type="text" class="form-control" v-model="nuevoProducto.imagen" required>
                </div>
                <button type="submit" class="btn btn-primary">Agregar</button>
                <button class="btn btn-secondary" @click="goToPage('list')">Cancelar</button>
            </form>
        </div>
    </div>

    <!-- Agrega los enlaces a los archivos JS de Vue y Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

    <script>
        new Vue({
            el: '#app',
            data: {
                currentPage: 'list',
                productos: [],
                nuevoProducto: {
                    nombre: '',
                    precio: 0,
                    stock: 0,
                    imagen: ''
                }
            },
            methods: {
                goToPage(page) {
                    this.currentPage = page;
                },
                loadProductos() {
                    fetch('http://127.0.0.1:5000/productos')
                        .then(response => response.json())
                        .then(data => {
                            this.productos = data;
                        })
                        .catch(error => {
                            this.showAlert('Error al cargar los productos', 'error');
                            console.error(error);
                        });
                },
                createProducto() {
                    fetch('https://localhost/5000/productos', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(this.nuevoProducto)
                    })
                        .then(response => response.json())
                        .then(data => {
                            this.showAlert('Producto agregado exitosamente', 'success');
                            this.nuevoProducto = {
                                nombre: '',
                                precio: 0,
                                stock: 0,
                                imagen: ''
                            };
                            this.goToPage('list');
                            this.loadProductos();
                        })
                        .catch(error => {
                            this.showAlert('Error al agregar el producto', 'error');
                            console.error(error);
                        });
                },
                deleteProducto(id) {
                    fetch(`https://localhost/5000/productos/${id}`, {
                        method: 'DELETE'
                    })
                        .then(response => response.json())
                        .then(data => {
                            this.showAlert('Producto eliminado exitosamente', 'success');
                            this.loadProductos();
                        })
                        .catch(error => {
                            this.showAlert('Error al eliminar el producto', 'error');
                            console.error(error);
                        });
                },
                editProducto(id) {
                    // Aquí puedes agregar la lógica para editar un producto
                    // y redirigir a la página de edición.
                    // Puedes utilizar vue-router o una técnica similar para manejar la navegación.
                },
                showAlert(message, type) {
                    const alertContainer = document.getElementById('alert-container');
                    const alertElement = document.createElement('div');
                    alertElement.className = `alert alert-${type}`;
                    alertElement.textContent = message;
                    alertContainer.innerHTML = '';
                    alertContainer.appendChild(alertElement);
                }
            },
            mounted() {
                this.loadProductos();
            }
        });
    </script>

</body>
</html>
